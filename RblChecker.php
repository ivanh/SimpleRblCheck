<?php

class RblChecker
{
    public static $blacklists = array(
        "0spam.fusionzero.com",
        "0spam-killlist.fusionzero.com",
        "all.rbl.jp",
        "all.s5h.net",
        "all.spamrats.com",
        "all.spam-rbl.fr",
        "any.dnsl.ipquery.org",
        "aspews.ext.sorbs.net",
        "b.barracudacentral.org",
        "backscatter.spameatingmonkey.net",
        "badnets.spameatingmonkey.net",
        "bb.barracudacentral.org",
        "bl.blocklist.de",
        "bl.deadbeef.com",
        "bl.drmx.org",
        "bl.emailbasura.org",
        "bl.konstant.no",
        "bl.mailspike.net",
        "bl.mav.com.br",
        "bl.nszones.com",
        "bl.score.senderscore.com",
        "bl.spamcannibal.org",
        "bl.spamcop.net",
        "bl.spameatingmonkey.net",
        "bl.spamstinks.com",
        "black.junkemailfilter.com",
        "blackholes.five-ten-sg.com",
        "blackholes.wirehub.net",
        "blacklist.sci.kun.nl",
        "blacklist.woody.ch",
        "block.dnsbl.sorbs.net",
        "blocked.hilli.dk",
        "bogons.cymru.com",
        "bsb.empty.us",
        "bsb.spamlookup.net",
        "cart00ney.surriel.com",
        "cbl.abuseat.org",
        "cbl.anti-spam.org.cn",
        "cblless.anti-spam.org.cn",
        "cblplus.anti-spam.org.cn",
        "cdl.anti-spam.org.cn",
        "cidr.bl.mcafee.com",
        "combined.abuse.ch",
        "combined.rbl.msrbl.net",
        "db.wpbl.info",
        "dev.null.dk",
        "dialup.blacklist.jippg.org",
        "dialups.mail-abuse.org",
        "dialups.visi.com",
        "dnsbl.abuse.ch",
        "dnsbl.anticaptcha.net",
        "dnsbl.antispam.or.id",
        "dnsbl.aspnet.hu",
        "dnsbl.burnt-tech.com",
        "dnsbl.cyberlogic.net",
        "dnsbl.dronebl.org",
        "dnsbl.inps.de",
        "dnsbl.ipocalypse.net",
        "dnsbl.justspam.org",
        "dnsbl.kempt.net",
        "dnsbl.madavi.de",
        "dnsbl.mags.net",
        "dnsbl.proxybl.org",
        "dnsbl.rizon.net",
        "dnsbl.rv-soft.info",
        "dnsbl.rymsho.ru",
        "dnsbl.sorbs.net",
        "dnsbl.spam-champuru.livedoor.com",
        "dnsbl.tornevall.org",
        "dnsbl.webequipped.com",
        "dnsbl.zapbl.net",
        "dnsbl-0.uceprotect.net",
        "dnsbl-1.uceprotect.net",
        "dnsbl-2.uceprotect.net",
        "dnsbl-3.uceprotect.net",
        "dnsrbl.swinog.ch",
        "drone.abuse.ch",
        "duinv.aupads.org",
        "dul.dnsbl.sorbs.net",
        "dul.pacifier.net",
        "dul.ru",
        "dyn.nszones.com",
        "dyna.spamrats.com",
        "dynip.rothen.com",
        "escalations.dnsbl.sorbs.net",
        "exitnodes.tor.dnsbl.sectoor.de",
        "feb.spamlab.com",
        "free.v4bl.org",
        "fresh.spameatingmonkey.net",
        "hil.habeas.com",
        "hostkarma.junkemailfilter.com",
        "http.dnsbl.sorbs.net",
        "httpbl.abuse.ch",
        "images.rbl.msrbl.net",
        "intercept.datapacket.net",
        "intruders.docs.uu.se",
        "ipbl.mailhosts.org",
        "ipbl.zeustracker.abuse.ch",
        "ips.backscatterer.org",
        "ix.dnsbl.manitu.net",
        "korea.services.net",
        "l1.bbfh.ext.sorbs.net",
        "l2.bbfh.ext.sorbs.net",
        "l3.bbfh.ext.sorbs.net",
        "l4.bbfh.ext.sorbs.net",
        "list.bbfh.org",
        "list.blogspambl.com",
        "lookup.dnsbl.iip.lu",
        "mail-abuse.blacklist.jippg.org",
        "misc.dnsbl.sorbs.net",
        "msgid.bl.gweep.ca",
        "multi.surbl.org",
        "netbl.spameatingmonkey.net",
        "netblock.dnsl.ipquery.org",
        "netblockbl.spamgrouper.com",
        "netscan.rbl.blockedservers.com",
        "new.dnsbl.sorbs.net",
        "new.spam.dnsbl.sorbs.net",
        "nomail.rhsbl.sorbs.net",
        "no-more-funn.moensted.dk",
        "noptr.spamrats.com",
        "nospam.ant.pl",
        "ohps.dnsbl.net.au",
        "old.dnsbl.sorbs.net",
        "old.spam.dnsbl.sorbs.net",
        "omrs.dnsbl.net.au",
        "opm.tornevall.org",
        "orvedb.aupads.org",
        "osps.dnsbl.net.au",
        "osrs.dnsbl.net.au",
        "owfs.dnsbl.net.au",
        "owps.dnsbl.net.au",
        "pbl.spamhaus.org",
        "phishing.rbl.msrbl.net",
        "pofon.foobar.hu",
        "probes.dnsbl.net.au",
        "problems.dnsbl.sorbs.net",
        "proxies.dnsbl.sorbs.net",
        "proxy.bl.gweep.ca",
        "proxy.block.transip.nl",
        "psbl.surriel.com",
        "pss.spambusters.org.ar",
        "rbl.abuse.ro",
        "rbl.blockedservers.com",
        "rbl.dns-servicios.com",
        "rbl.efnet.org",
        "rbl.efnetrbl.org",
        "rbl.fasthosts.co.uk",
        "rbl.interserver.net",
        //"rbl.iprange.net", seems to blacklist everything
        "rbl.megarbl.net",
        "rbl.orbitrbl.com",
        "rbl.polarcomm.net",
        "rbl.schulte.org",
        "rbl.snark.net",
        "rbl.spamlab.com",
        "rbl.talkactive.net",
        "rbl2.triumf.ca",
        "rdts.dnsbl.net.au",
        "recent.dnsbl.sorbs.net",
        "recent.spam.dnsbl.sorbs.net",
        "relays.bl.gweep.ca",
        "relays.bl.kundenserver.de",
        "relays.dnsbl.sorbs.net",
        "relays.nether.net",
        "residential.block.transip.nl",
        "ricn.dnsbl.net.au",
        "rmst.dnsbl.net.au",
        "rsbl.aupads.org",
        "safe.dnsbl.sorbs.net",
        "sbl.nszones.com",
        "sbl.spamhaus.org",
        "sbl-multi.spamrl.com",
        "sbl-xbl.spamhaus.org",
        "short.rbl.jp",
        "shortlist.mailhosts.org",
        "singlebl.spamgrouper.com",
        "smtp.dnsbl.sorbs.net",
        "socks.dnsbl.sorbs.net",
        "spam.abuse.ch",
        "spam.dnsbl.anonmails.de",
        "spam.dnsbl.sorbs.net",
        "spam.olsentech.net",
        "spam.pedantic.org",
        "spam.rbl.blockedservers.com",
        "spam.rbl.msrbl.net",
        "spam.spamrats.com",
        "spamguard.leadmon.net",
        "spamlist.or.kr",
        "spamrbl.imp.ch",
        "spamsources.fabel.dk",
        "st.technovision.dk",
        "t3direct.dnsbl.net.au",
        "tor.dnsbl.sectoor.de",
        "tor.efnet.org",
        "torexit.dan.me.uk",
        "torserver.tor.dnsbl.sectoor.de",
        "truncate.gbudb.net",
        "ubl.lashback.com",
        "ubl.unsubscore.com",
        "unsure.nether.net",
        "uribl.spameatingmonkey.net",
        "urired.spameatingmonkey.net",
        "v4.fullbogons.cymru.com",
        "virbl.bit.nl",
        "virbl.dnsbl.bit.nl",
        "virus.rbl.jp",
        "virus.rbl.msrbl.net",
        "vote.drbl.caravan.ru",
        "vote.drbl.gremlin.ru",
        "vote.drbldf.dsbl.ru",
        "web.dnsbl.sorbs.net",
        "web.rbl.msrbl.net",
        "work.drbl.caravan.ru",
        "work.drbl.gremlin.ru",
        "work.drbldf.dsbl.ru",
        "wormrbl.imp.ch",
        "xbl.spamhaus.org",
        "xs.surbl.org",
        "z.mailspike.net",
        "zen.spamhaus.org",
        "zombie.dnsbl.sorbs.net"
    );
    public function check($ip)
    {
        $r = new Net_DNS2_Resolver(array());
        $parts = explode('.', $ip);
        foreach(self::$blacklists as $b)
        {
            try {
                $r->query(sprintf('%d.%d.%d.%d.%s', $parts[3], $parts[2], $parts[1], $parts[0], $b), 'A');
            } catch(Net_DNS2_Exception $e) {
                continue;
            }
            $fails[] = array('ip' => $i, 'list' => $b);
        }
    }
}
